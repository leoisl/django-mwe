name: Docker Image Build

on:
    workflow_dispatch: {}
    push:
        paths-ignore:
            - '.infra/**'
            - '.github/**'
        branches-ignore:
          - main

jobs:
  argus_builder:
    permissions:
      id-token: write
      contents: read
    uses: chanzuckerberg/github-actions/.github/workflows/argus-docker-build.yaml@heathj/docker-build-runson
    secrets:
      app_id: ${{ secrets.CZI_GITHUB_HELPER_APP_ID }}
      pk: ${{ secrets.CZI_GITHUB_HELPER_PK }}
    with:
      env: rdev
      ecr_root_path: ./.infra/ecr
      images: |
        [
          {
            "name": "backend",
            "context": ".",
            "dockerfile": "Dockerfile",
            "platform": "linux/arm64"
          }
        ]
